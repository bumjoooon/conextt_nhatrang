<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Conextt - 여행 베트남어</title>
  <style>
    :root{
      --bg:#ffffff; --ink:#111827; --muted:#6b7280;
      --border:#e5e7eb; --card:#f9fafb; --pill:#eef2ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.06);
      --max:1100px;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:system-ui,-apple-system,sans-serif; color:var(--ink); background:var(--bg); }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:var(--max); margin:0 auto; padding:14px; }

    .topbar{
      position:sticky; top:0; z-index:1000;
      background:rgba(255,255,255,.9);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .topbar__inner{
      max-width:var(--max); margin:0 auto;
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:900;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
    }
    .menu{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .menu a{
      border:1px solid var(--border);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
    }
    .menu a.active{ background:var(--pill); border-color:#c7d2fe; }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
      box-shadow: var(--shadow);
    }
    h1{ margin:0; font-size:22px; }
    h2{ margin:0 0 8px; font-size:14px; }
    .muted{ color:var(--muted); font-size:12px; line-height:1.4; }

    /* 번역 영역 */
    .translate{
      display:grid; gap:10px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 980px){
      .translate{ grid-template-columns: 1.2fr .4fr 1.4fr; align-items:end; }
    }
    label{ display:block; font-size:12px; color:#374151; margin:10px 0 6px; }
    input, textarea, button{
      width:100%;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      background:#fff;
    }
    textarea{ min-height:90px; resize:vertical; }
    button{ cursor:pointer; }
    button.primary{ background:#111827; color:#fff; border-color:#111827; }

    /* 카테고리 카드 */
    .cats{
      display:grid; gap:12px;
      grid-template-columns: 1fr;
      margin-top:12px;
    }
    @media (min-width: 980px){
      .cats{ grid-template-columns: 1fr 1fr; }
    }
    .cat{
      background:#fff;
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
    }
    .cat .top{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .cat h3{ margin:0; font-size:16px; font-weight:900; }
    .btn{
      width:auto;
      border:1px solid var(--border);
      background:#fff;
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
    }
    .list{ margin-top:10px; display:grid; gap:8px; }
    .phrase{
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      background:#f9fafb;
    }
    .phrase .kr{ font-weight:800; }
    .phrase .vi{ margin-top:4px; }
    .phrase .pr{ margin-top:4px; color:var(--muted); font-size:12px; }
    .phrase .actions{ margin-top:8px; display:flex; justify-content:flex-end; gap:8px; }
    .chip{ font-size:12px; padding:3px 8px; border-radius:999px; background:var(--pill); border:1px solid #c7d2fe; }

    .hint{
      margin-top:8px;
      padding:10px;
      border:1px dashed var(--border);
      border-radius:12px;
      background:#fff;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar__inner">
      <a class="brand" href="index.html">Conextt</a>
      <nav class="menu" aria-label="Pages">
        <a href="index.html" data-nav="index">Main</a>
        <a href="schedule.html" data-nav="schedule">여행 일정</a>
        <a href="vietnamese.html" data-nav="vn">여행 베트남어</a>
        <a href="photos.html" data-nav="photos">사진</a>
        <a href="videos.html" data-nav="videos">영상</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div style="display:flex; align-items:baseline; justify-content:space-between; gap:10px; flex-wrap:wrap;">
      <h1>여행 베트남어</h1>
      <div class="muted">오프라인 사전 기반(추가/삭제 가능)</div>
    </div>

    <section class="card" style="margin-top:12px;">
      <h2>번역</h2>
      <div class="translate">
        <div>
          <label>한국어 입력 칸</label>
          <textarea id="koInput" placeholder="예) 물 한 병 주세요"></textarea>
        </div>

        <div>
          <label>&nbsp;</label>
          <button class="primary" id="translateBtn">번역</button>
          <button style="margin-top:8px;" id="swapBtn">↔︎</button>
        </div>

        <div>
          <label>베트남어 번역 (+발음)</label>
          <textarea id="viOutput" placeholder="여기에 결과가 표시됩니다." readonly></textarea>
        </div>
      </div>

      <div class="hint">
        <!-- 중요: 실제 “자동 번역”을 하려면 서버/API가 필요합니다.
             지금은 오프라인에서 쓸 수 있게 “내가 등록한 문장(사전)”에서 찾아주는 방식입니다. -->
        * 현재는 “내가 등록한 문장(사전)”에서 유사한 문장을 찾아 결과를 보여주는 방식입니다.<br/>
        * 원하는 문장을 아래 카테고리에 계속 추가해두면, 여행 중엔 오프라인처럼 빠르게 꺼내쓸 수 있습니다.
      </div>
    </section>

    <section class="card" style="margin-top:12px;">
      <h2>카테고리</h2>
      <div class="muted">각 박스 오른쪽 “추가” 버튼으로 표현을 늘릴 수 있습니다.</div>

      <div class="cats" id="cats">
        <!-- JS로 렌더 -->
      </div>
    </section>
  </main>

  <script>
    // nav active
    (() => {
      const path = (location.pathname.split("/").pop() || "index.html").toLowerCase();
      const map = {
        "index.html":"index",
        "schedule.html":"schedule",
        "vietnamese.html":"vn",
        "photos.html":"photos",
        "videos.html":"videos",
      };
      const key = map[path];
      document.querySelectorAll("[data-nav]").forEach(a => {
        if (a.getAttribute("data-nav") === key) a.classList.add("active");
      });
    })();

    const KEY = "conextt_vn_phrases_v1";
    const $ = (id) => document.getElementById(id);

    function uid(){ return (crypto.randomUUID && crypto.randomUUID()) || String(Date.now() + Math.random()); }
    function escapeHtml(s){
      return (s ?? "").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
    }

    // ✅ 기본 예시 문장들 (원하시면 여기 더 추가하세요)
    //    형식: { cat, kr, vi, pr }
    //    cat 값은 아래 CATEGORIES의 key와 동일해야 합니다.
    const DEFAULT = [
      { cat:"greeting",  kr:"안녕하세요", vi:"Xin chào", pr:"씬 짜오" },
      { cat:"greeting",  kr:"감사합니다", vi:"Cảm ơn", pr:"깜 언" },
      { cat:"restaurant",kr:"물 한 병 주세요", vi:"Cho tôi một chai nước", pr:"초 또이 못 차이 느억" },
      { cat:"restaurant",kr:"이거 하나 주세요", vi:"Cho tôi cái này", pr:"초 또이 까이 나이" },
      { cat:"transport", kr:"여기까지 얼마예요?", vi:"Đến đây bao nhiêu tiền?", pr:"덴 더이 바오 니에우 띠엔" },
      { cat:"transport", kr:"공항으로 가 주세요", vi:"Làm ơn chở tôi đến sân bay", pr:"람 언 쩌 또이 덴 선 바이" },
      { cat:"hotel",     kr:"체크인하고 싶어요", vi:"Tôi muốn nhận phòng", pr:"또이 무온 년 퐁" },
      { cat:"hotel",     kr:"도와주세요", vi:"Cứu tôi với!", pr:"끄우 또이 버이" },
    ];

    const CATEGORIES = [
      { key:"greeting",  title:"기본인사", anchor:"greeting" },
      { key:"restaurant",title:"가게/주문", anchor:"restaurant" },
      { key:"transport", title:"교통/이동", anchor:"transport" },
      { key:"hotel",     title:"숙소/응급", anchor:"hotel" },
    ];

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        const arr = raw ? JSON.parse(raw) : null;
        return Array.isArray(arr) ? arr : null;
      } catch { return null; }
    }
    function save(arr){
      localStorage.setItem(KEY, JSON.stringify(arr));
    }

    let phrases = load();
    if (!phrases){
      phrases = DEFAULT.map(x => ({ id: uid(), ...x }));
      save(phrases);
    }

    function render(){
      const host = $("cats");
      host.innerHTML = CATEGORIES.map(cat => {
        const list = phrases.filter(p => p.cat === cat.key);
        return `
          <div class="cat" id="${cat.anchor}">
            <div class="top">
              <h3>${escapeHtml(cat.title)}</h3>
              <div style="display:flex; gap:8px; align-items:center;">
                <span class="chip">${list.length}개</span>
                <button class="btn" data-add="${cat.key}">추가</button>
              </div>
            </div>

            <div class="list">
              ${list.length ? list.map(p => `
                <div class="phrase">
                  <div class="kr">KR · ${escapeHtml(p.kr)}</div>
                  <div class="vi"><b>VI</b> · ${escapeHtml(p.vi)}</div>
                  ${p.pr ? `<div class="pr">발음 · ${escapeHtml(p.pr)}</div>` : ``}
                  <div class="actions">
                    <button class="btn" data-del="${p.id}">삭제</button>
                  </div>
                </div>
              `).join("") : `<div class="muted">아직 없음. “추가”로 등록하세요.</div>`}
            </div>
          </div>
        `;
      }).join("");

      document.querySelectorAll("[data-add]").forEach(btn => {
        btn.addEventListener("click", () => addPhrase(btn.getAttribute("data-add")));
      });
      document.querySelectorAll("[data-del]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-del");
          phrases = phrases.filter(x => x.id !== id);
          save(phrases);
          render();
        });
      });
    }

    function addPhrase(catKey){
      const kr = prompt("한국어 문장을 입력하세요");
      if (!kr) return;
      const vi = prompt("베트남어 문장을 입력하세요");
      if (!vi) return;
      const pr = prompt("발음(선택) - 비워도 됩니다") || "";
      phrases.unshift({ id: uid(), cat: catKey, kr: kr.trim(), vi: vi.trim(), pr: pr.trim() });
      save(phrases);
      render();
    }

    // ===== 번역(오프라인 사전 검색) =====
    function normalize(s){
      return (s || "").toLowerCase().replace(/\s+/g, " ").trim();
    }
    function bestMatch(input){
      const q = normalize(input);
      if (!q) return null;

      // 1) 정확히 같은 문장
      let hit = phrases.find(p => normalize(p.kr) === q || normalize(p.vi) === q);
      if (hit) return hit;

      // 2) 포함관계 / 키워드 유사
      const scored = phrases.map(p => {
        const a = normalize(p.kr);
        const b = normalize(p.vi);
        let score = 0;
        if (a.includes(q) || q.includes(a)) score += 3;
        if (b.includes(q) || q.includes(b)) score += 2;

        // 단어 겹침
        const qWords = new Set(q.split(" "));
        const aWords = new Set(a.split(" "));
        let common = 0;
        qWords.forEach(w => { if (aWords.has(w)) common++; });
        score += common * 0.5;

        return { p, score };
      }).sort((x,y) => y.score - x.score);

      return scored[0]?.score > 0 ? scored[0].p : null;
    }

    $("translateBtn").addEventListener("click", () => {
      const src = $("koInput").value.trim();
      const m = bestMatch(src);
      if (!m){
        $("viOutput").value =
          "사전에 없는 문장입니다.\n\n" +
          "아래 카테고리에 문장을 추가해두면,\n" +
          "다음부터는 여기서 바로 찾아서 보여드릴게요.";
        return;
      }
      $("viOutput").value =
        `VI: ${m.vi}\n` +
        (m.pr ? `발음: ${m.pr}\n` : "") +
        `\n(사전 항목)\nKR: ${m.kr}`;
    });

    $("swapBtn").addEventListener("click", () => {
      const a = $("koInput").value;
      const b = $("viOutput").value;
      $("koInput").value = b;
      $("viOutput").value = a;
    });

    render();
  </script>
</body>
</html>
